---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 04-data-structures-part2.md in _episodes_rmd/
title: "Exploring Data Frames"
teaching: 20
exercises: 10
questions:
- "How can I manipulate a data frame?"
objectives:
- "Remove rows with `NA` values."
- "Append two data frames."
- "Understand what a `factor` is."
- "Convert a `factor` to a `character` vector and vice versa."
- "Display basic properties of data frames including size and class of the columns, names, and first few rows."
keypoints:
- "Use `cbind()` to add a new column to a data frame."
- "Use `rbind()` to add a new row to a data frame."
- "Remove rows from a data frame."
- "Use `na.omit()` to remove rows from a data frame with `NA` values."
- "Use `levels()` and `as.character()` to explore and manipulate factors."
- "Use `str()`, `nrow()`, `ncol()`, `dim()`, `colnames()`, `rownames()`, `head()`, and `typeof()` to understand the structure of a data frame."
- "Read in a csv file using `read.csv()`."
- "Understand what `length()` of a data frame represents."
source: Rmd
---



На цьому етапі, ви бачили все: на минулому уроці, ми ознайомились з усіма основними
типами даних і структурами даних в R. Все, що ви робите, буде маніпуляцією з
цими інструментами. Але найчастіше, зіркою шоу є фрейм даних — таблиця, яку ми створили шляхом завантаження інформації з файлу csv. У цьому уроці, ми дізнаємося ще кілька речей
про роботу з фреймами даних.

## Реалістичний приклад

Ми вже дізнались, що стовпці кадру даних є векторами, тому наші
дані мають узгоджений тип у всіх стовпцях. 
Поки що, ви бачили основи маніпулювання кадрами даних за допомогою наших скандинавських даних; тепер давайте використаємо ці навички, щоб переварити більший набір даних. Давайте прочитаємо набір даних gapminder, який ми завантажили раніше :



> ## Різні поради
>
> * Ще один тип файлів, з яким ви можете зіткнутись, це файли із розділеними табуляціями
>   (.tsv). Щоб указати табуляцію, використовуйте `"\\t"` або `read.delim()`.
>
> * Файли також можна завантажувати безпосередньо з Інтернету в локальну папку
> за вашим вибором на ваш комп'ютер, використовуючи функцію `download.file`. Потім цю функцію
> `read.csv` можна виконати для читання завантаженого файлу з
> місця завантаження, наприклад,
>
> 
> ~~~
> download.file("https://raw.githubusercontent.com/datacarpentry/r-intro-geospatial/master/_episodes_rmd/data/gapminder_data.csv",
>               destfile = "data/gapminder_data.csv")
> gapminder <- read.csv("data/gapminder_data.csv")
> ~~~
> {: .language-r}
>
> * Крім того, ви також можете читати файли безпосередньо в R з інтернету,
>   замінивши шляхи файлів веб-адресою в `read.csv`. Слід
>   зауважити, що при цьому локальна копія файлу csv спочатку не зберігається на
>   вашому комп'ютері. Наприклад,
> 
> 
> ~~~
> gapminder <- read.csv("https://raw.githubusercontent.com/datacarpentry/r-intro-geospatial/master/_episodes_rmd/data/gapminder_data.csv")
> ~~~
> {: .language-r}
>
> * Ви можете читати безпосередньо з таблиць excel
> не перетворюючи їх у звичайний текст за допомогою пакета [readxl](https://cran.r-project.org/package=readxl).
{: .callout}

Давайте трохи дослідимо дата фрейм `gapminder`; перше, що ми повинні
завжди робити, це перевіряти, як викглядають дані за допомогою `str`:


~~~
str(gapminder)
~~~
{: .language-r}



~~~
'data.frame':\t1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...
~~~
{: .output}

Ми також можемо перевірити окремі стовпці кадру даних за допомогою функції `class`:


~~~
class(gapminder$year)
~~~
{: .language-r}



~~~
[1] "integer"
~~~
{: .output}



~~~
class(gapminder$country)
~~~
{: .language-r}



~~~
[1] "character"
~~~
{: .output}



~~~
str(gapminder$country)
~~~
{: .language-r}



~~~
 chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
~~~
{: .output}

Ми також можемо запитати кадр даних для отримання інформації про його розміри;
пам'ятаючи те, що `str(gapminder)` сказав, що в gapminder було 1704 спостережень за 6
змінними, як ви думаєте, що дасть наступне і чому?


~~~
length(gapminder)
~~~
{: .language-r}

Справедливим припущенням було б сказати, що довжина кадру даних дорівнює
кількості рядків, які він має (1704), але це не так; це дає нам кількість стовпців.


~~~
class(gapminder)
~~~
{: .language-r}



~~~
[1] "data.frame"
~~~
{: .output}

Щоб отримати кількість рядків і стовпців у нашому наборі даних, спробуйте:


~~~
nrow(gapminder)
~~~
{: .language-r}



~~~
[1] 1704
~~~
{: .output}



~~~
ncol(gapminder)
~~~
{: .language-r}



~~~
[1] 6
~~~
{: .output}

Або обидва одразу:


~~~
dim(gapminder)
~~~
{: .language-r}



~~~
[1] 1704    6
~~~
{: .output}

Ймовірно, ми також захочемо знати заголовки всіх стовпців, щоб
запитати їх пізніше:


~~~
colnames(gapminder)
~~~
{: .language-r}



~~~
[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"
~~~
{: .output}

На цьому етапі, важливо запитати себе,яи структура про яку повідомляє R
відповідає нашій інтуїції чи очікуванням; чи мають сенс основні типи даних, які повідомляють для кожного
стовпця? Якщо ні, нам потрібно розібратися з будь-якими проблемами зараз, поки вони не обернуться
непприємними сюрпризами, виуористовуючи те, що ми дізналися, про те, як R
інтерпретує дані, і важливість *суворої узгодженості* в тому, як ми записуємо наші
дані.

Коли ми переконаємося, що типи та структури виглядають прийнятно, настав час
почати копатися в наших даних. Перегляньте кілька перших рядків:


~~~
head(gapminder)
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134
~~~
{: .output}

> ## Завдання 1
>
> Рекомендується також перевіряти кілька останніх рядків даних і деякі
> посередині. Як би ви це зробили?
>
> Пошук тих, що знаходятьчя саме посередині, не надто складний, але ми можемо
> просто запитати кілька рядків навмання. Як би ви написали цей код?
>
> > ## Розв'язання до завдання 1
> >
> > Перевірити останні кілька рядків відносно просто, оскільки R вже має
> > функцію для цього:
> > 
> > 
> > ~~~
> > tail(gapminder)
> > tail(gapminder, n = 15)
> > ~~~
> > {: .language-r}
> > 
> > А як щодо кількох довільних рядків лише для розсудливості (або божевілля залежно від вашої 
> > точки зору)?
> >
> > Є кілька способів досягти цього.
> >
> > Рішення тут представляє одну форму з використанням фкладених функцій, тобто функція
> > передається як аргумент іншій функції. Це може звучати, як нова
> > концепція, але по факту, ви вже її використовуєте.
> >
> > Пам'ятайте `my_dataframe[rows, cols]` надрукує ваш дата фрейм
> > з тією кількістю рядків і стовпців, яку ви попросите (хоча ви могли 
> > просити, наприклад, діапазон або іменовані стовпці). Як отримати
> > останній рядок, якщо ви не знаєте, скільки рядків має ваш дата фрейм? R має
> > функцію для цього. Як щодо отримання (псевдовипадкової) вибірки? R такоє має
> > функцію для цього.
> > 
> > 
> > ~~~
> > gapminder[sample(nrow(gapminder), 5), ]
> > ~~~
> > {: .language-r}
> {: .solution}
{: .challenge}

> ## Завдання 2
>
> Прочитайте вихід `str(gapminder)` знову; цього разу, використовуйте, те що ви дізнались
> про множини та вектори, а також про вихід функцій, таких як `colnames`
> і `dim`, щоб пояснити, що означає все, що друкує `str` з `gapminder`.
> Якщо є якісь частини, які ви не можете інтерпретувати, обговоріть зі своїми
> одногрупниками!
>
> > ## Розв'язання до завдання 2
> >
> > Об'єкт `gapminder` - це фрейм даних зі стовпцями
> >
> > - `country` і `continent` є факторами.
> > - `year` - це цілий вектор.
> > - `pop`, `lifeExp`, і `gdpPercap` - це числові вектори.
> {: .solution}
{: .challenge}

## Додавання стовпців та рядків у фрейми даних

Ми б хотіли створити новий стовпець для інформації, про те, чи є очікувана тривалість життя нижче середньосвітової очікуваної тривалості життя (70.5) чи вище:


~~~
below_average <- gapminder$lifeExp < 70.5
head(gapminder)
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134
~~~
{: .output}

Потім ми можемо додати це, як стовпець за допомогою:


~~~
cbind(gapminder, below_average)
~~~
{: .language-r}


~~~
      country year      pop continent lifeExp gdpPercap below_average
1 Afghanistan 1952  8425333      Asia  28.801  779.4453          TRUE
2 Afghanistan 1957  9240934      Asia  30.332  820.8530          TRUE
3 Afghanistan 1962 10267083      Asia  31.997  853.1007          TRUE
4 Afghanistan 1967 11537966      Asia  34.020  836.1971          TRUE
5 Afghanistan 1972 13079460      Asia  36.088  739.9811          TRUE
6 Afghanistan 1977 14880372      Asia  38.438  786.1134          TRUE
~~~
{: .output}

Ймовірно, ми не хочемо щоразу друкувати весь фрейм даних, тому
давайте розмістимо нашу команду `cbind` всередині виклику `head`, щоб повернути 
лише перші 6 рядків виводу.


~~~
head(cbind(gapminder, below_average))
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp gdpPercap below_average
1 Afghanistan 1952  8425333      Asia  28.801  779.4453          TRUE
2 Afghanistan 1957  9240934      Asia  30.332  820.8530          TRUE
3 Afghanistan 1962 10267083      Asia  31.997  853.1007          TRUE
4 Afghanistan 1967 11537966      Asia  34.020  836.1971          TRUE
5 Afghanistan 1972 13079460      Asia  36.088  739.9811          TRUE
6 Afghanistan 1977 14880372      Asia  38.438  786.1134          TRUE
~~~
{: .output}

Зауважте, що якщо ми спробуємо додати вектор  `below_average` із різною кількістю записів, яка відрізняється від кількості рядків у фреймі даних, то нам це не вдасться:   


~~~
below_average <- c(TRUE, TRUE, TRUE, TRUE, TRUE)
head(cbind(gapminder, below_average))
~~~
{: .language-r}



~~~
Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 1704, 5
~~~
{: .error}

Чому це не спрацювало? R хоче бачити один елемент у нашому новому стовпці
для кожного рядка в таблиці:


~~~
nrow(gapminder)
~~~
{: .language-r}



~~~
[1] 1704
~~~
{: .output}



~~~
length(below_average)
~~~
{: .language-r}



~~~
[1] 5
~~~
{: .output}

Отже, щоб це працювало, нам потрібно, щоб `nrow(gapminder)` = `length(below_average)` або, щоб `nrow(gapminder)` було кратним `length(below_average)`: 


~~~
below_average <- c(TRUE, TRUE, FALSE)
head(cbind(gapminder, below_average))
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp gdpPercap below_average
1 Afghanistan 1952  8425333      Asia  28.801  779.4453          TRUE
2 Afghanistan 1957  9240934      Asia  30.332  820.8530          TRUE
3 Afghanistan 1962 10267083      Asia  31.997  853.1007         FALSE
4 Afghanistan 1967 11537966      Asia  34.020  836.1971          TRUE
5 Afghanistan 1972 13079460      Asia  36.088  739.9811          TRUE
6 Afghanistan 1977 14880372      Asia  38.438  786.1134         FALSE
~~~
{: .output}
Посдіовність `TRUE,TRUE,FALSE` повторюється для всіх рядків gapminder.

Давайте замінимо вміст gapminder нашим новим фреймом даних.


~~~
below_average <-  as.logical(gapminder$lifeExp<70.5)
gapminder <- cbind(gapminder, below_average)
~~~
{: .language-r}

А як щодо додавання рядків? Рядки фрейму даних є списками:


~~~
new_row <- list('Norway', 2016, 5000000, 'Nordic', 80.3, 49400.0, FALSE)
gapminder_norway <- rbind(gapminder, new_row)
tail(gapminder_norway)
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp  gdpPercap below_average
1700 Zimbabwe 1987  9216418    Africa  62.351   706.1573          TRUE
1701 Zimbabwe 1992 10704340    Africa  60.377   693.4208          TRUE
1702 Zimbabwe 1997 11404948    Africa  46.809   792.4500          TRUE
1703 Zimbabwe 2002 11926563    Africa  39.989   672.0386          TRUE
1704 Zimbabwe 2007 12311143    Africa  43.487   469.7093          TRUE
1705   Norway 2016  5000000    Nordic  80.300 49400.0000         FALSE
~~~
{: .output}

Щоб зрозуміти, чому R дає нам попередження, коли ми намагаємося додати цей рядок, давайте дізнаємося трохи більше про фактори. 

## Фактори

Ось ще одна річ, на яку потрібно звернути увагу: у `factor`, кожне окреме значення
представляє, що називається `level`. У нашому випадку,  `factor` "континент" має 5
рівнів: "Africa", "Americas", "Asia", "Europe" and "Oceania". R прийматиме лише
ті значення, які відповідають одному з рівнів. Якщо ви додасте нове значення, воно стане
`NA`.

Попередження говорить нам про те, що ми невдало додали "Nordic" до нашого
*континет* фактору, але 2016 (числове), 5000000 (числове), 80.3 (числове),
49400.0 (числове) і `FALSE` (логічне) були успішно додані до
*country*, *year*, *pop*, *lifeExp*, *gdpPercap* і *below_average*
відповідно, оскільки ці змінні не є факторами. 'Norway' також була
успішно додана, оскільки вона відповідає існуючому рівню. Щоб успішно
додати рядок gapminder з "Nordic" *континент*, і "Nordic" як *рівень* 
фактора:


~~~
levels(gapminder$continent)
~~~
{: .language-r}



~~~
NULL
~~~
{: .output}



~~~
levels(gapminder$continent) <- c(levels(gapminder$continent), "Nordic")
gapminder_norway  <- rbind(gapminder,
                           list('Norway', 2016, 5000000, 'Nordic', 80.3,49400.0, FALSE))
~~~
{: .language-r}



~~~
Warning in `[<-.factor`(`*tmp*`, ri, value = structure(c("Asia", "Asia", :
invalid factor level, NA generated
~~~
{: .warning}



~~~
tail(gapminder_norway)
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp  gdpPercap below_average
1700 Zimbabwe 1987  9216418      <NA>  62.351   706.1573          TRUE
1701 Zimbabwe 1992 10704340      <NA>  60.377   693.4208          TRUE
1702 Zimbabwe 1997 11404948      <NA>  46.809   792.4500          TRUE
1703 Zimbabwe 2002 11926563      <NA>  39.989   672.0386          TRUE
1704 Zimbabwe 2007 12311143      <NA>  43.487   469.7093          TRUE
1705   Norway 2016  5000000    Nordic  80.300 49400.0000         FALSE
~~~
{: .output}

Крім того, ми можемо змінити фактор на символьний вектор; ми втрачаємо зручні
категорії фактора, але згодом ми можемо додати до стовпця будь-яке слово, 
яке ми захочемо, не піклуючись про рівні фактора:


~~~
str(gapminder)
~~~
{: .language-r}



~~~
'data.frame':\t1704 obs. of  7 variables:
 $ country      : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year         : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop          : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent    : chr  "Asia" "Asia" "Asia" "Asia" ...
  ..- attr(*, "levels")= chr "Nordic"
 $ lifeExp      : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap    : num  779 821 853 836 740 ...
 $ below_average: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
~~~
{: .output}



~~~
gapminder$continent <- as.character(gapminder$continent)
str(gapminder)
~~~
{: .language-r}



~~~
'data.frame':\t1704 obs. of  7 variables:
 $ country      : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year         : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop          : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent    : chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp      : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap    : num  779 821 853 836 740 ...
 $ below_average: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
~~~
{: .output}

## Додавання до фрейму даних

Під час додавання до фрейму даних, слід пам'ятати, що *стовпці - це 
вектори і рядки - це списки.* Ми також можемо склеїти два фрейма даних разом, використовуючи
`rbind`:


~~~
gapminder <- rbind(gapminder, gapminder)
tail(gapminder, n=3)
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp gdpPercap below_average
3406 Zimbabwe 1997 11404948    Africa  46.809  792.4500          TRUE
3407 Zimbabwe 2002 11926563    Africa  39.989  672.0386          TRUE
3408 Zimbabwe 2007 12311143    Africa  43.487  469.7093          TRUE
~~~
{: .output}
Але тепер назви рядків надто складні (не послідовні номери).
Ми можемо видалити назви рядків, і R автоматично перейменує їх послідовно:


~~~
rownames(gapminder) <- NULL
head(gapminder)
~~~
{: .language-r}



~~~
      country year      pop continent lifeExp gdpPercap below_average
1 Afghanistan 1952  8425333      Asia  28.801  779.4453          TRUE
2 Afghanistan 1957  9240934      Asia  30.332  820.8530          TRUE
3 Afghanistan 1962 10267083      Asia  31.997  853.1007          TRUE
4 Afghanistan 1967 11537966      Asia  34.020  836.1971          TRUE
5 Afghanistan 1972 13079460      Asia  36.088  739.9811          TRUE
6 Afghanistan 1977 14880372      Asia  38.438  786.1134          TRUE
~~~
{: .output}

> ## Завдання 3
>
> Ви можете створити новий фрейм даних прямо з R за допомогою такого синтаксису:
> 
> ~~~
> df <- data.frame(id = c("a", "b", "c"),
>                  x = 1:3,
>                  y = c(TRUE, TRUE, FALSE),
>                  stringsAsFactors = FALSE)
> ~~~
> {: .language-r}
>
> Створіть для себе фрейм даних, який містить таку інформацію:
>
> - ім'я
> - прізвище
> - щасливе число
>
> Потім використовуйте `rbind`, щоб додати запис для людей, які сидять поруч з вами. Нарешті,
> скористайтеся `cbind` для додавання стовпця з відповідями кожного користувача на запитання, "Чи
> час для перерви на каву?"
>
> > ## Розв'язання до завдання 3
> >
> > 
> > ~~~
> > df <- data.frame(first = c("Grace"),
> >                  last = c("Hopper"),
> >                  lucky_number = c(0),
> >                  stringsAsFactors = FALSE)
> > df <- rbind(df, list("Marie", "Curie", 238) )
> > df <- cbind(df, coffeetime = c(TRUE, TRUE))
> > ~~~
> > {: .language-r}
> {: .solution}
{: .challenge}

